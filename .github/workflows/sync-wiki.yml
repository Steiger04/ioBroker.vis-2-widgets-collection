name: Sync Documentation to Wiki

on:
    workflow_call:

permissions:
    contents: write

jobs:
    sync-wiki:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v4

            - name: Prepare Wiki Content
              run: |
                  # Create temporary directory for wiki sync
                  mkdir -p /tmp/wiki-sync/img

                  # Copy main entry point
                  cp src-widgets/src/documentation/Home.md /tmp/wiki-sync/

                  # Copy wiki sidebar
                  cp src-widgets/src/documentation/_Sidebar.md /tmp/wiki-sync/

                  # Copy German documentation files
                  cp src-widgets/src/documentation/de/De-*.md /tmp/wiki-sync/

                  # Copy English documentation files
                  cp src-widgets/src/documentation/en/En-*.md /tmp/wiki-sync/

                  # Copy images
                  cp src-widgets/src/documentation/img/* /tmp/wiki-sync/img/

                  # Adjust image paths for wiki (../img/ â†’ img/)
                  find /tmp/wiki-sync -name "*.md" -type f -exec sed -i 's|../img/|img/|g' {} +

                  echo "Wiki content prepared successfully"

            - name: Sync to Wiki
              uses: Andrew-Chen-Wang/github-wiki-action@v5
              with:
                  path: /tmp/wiki-sync
                  token: ${{ secrets.GITHUB_TOKEN }}
